var bind=function(t,e){return function(){return t.apply(e,arguments)}};$(function(){var t,e,i,s,n,r,o,a,h,c,d,u,l,_,g,p,f,m,v,y;if(s=$(window),i=$("html"),e=$(document),t=$("body"),("undefined"==typeof u||null===u)&&(u={}),("undefined"==typeof g||null===g)&&(g={}),o="id_modal_get_archives",r="event_open_modal",h=function(){function t(){var t;this._isPC=!0,t=window.navigator.userAgent.toLowerCase(),0<=t.indexOf("iphone")||0<=t.indexOf("ipad")||0<=t.indexOf("ipod")?this._isPC=!1:0<=t.indexOf("windows")&&0<=t.indexOf("phone")?this._isPC=!1:0<=t.indexOf("android")&&0<=t.indexOf("mobile")?this._isPC=!1:0<=t.indexOf("firefox")&&0<=t.indexOf("mobile")?this._isPC=!1:0<=t.indexOf("blackberry")&&(this._isPC=!1),this._archives=[]}return t.prototype.getIsPc=function(){return Boolean(this._isPC)},t.prototype.setArchives=function(t){return this._archives=t},t.prototype.getArchives=function(){return this._archives},t.prototype.getArchiveById=function(t){var e,i,s,n;if(!t)return null;for(n=this._archives,i=0,s=n.length;s>i;i++)if(e=n[i],e.id===t)return e;return null},t}(),n=function(){function t(t){this._completeSlide=bind(this._completeSlide,this),this._startSlide=bind(this._startSlide,this);var e,i,s,n,r;for(this._$target=t.$target,this._$items=$("#js-archivesItems"),this._$carousel=$("#js-archivesCarousel"),this._$item=this._$target.find(".js-archivesItem").clone(),this._$data=this._$target.find("#js-archivesData"),this._$msg=this._$target.find("#js-archivesMsg"),this._$name=this._$target.find("#js-archivesName"),this._$counter=this._$target.find("#js-archivesCounter"),this._archives=y.getArchives(),this._arr=[],this._$items.empty(),this._setItem(),this._$carousel.carousel(),this._$counter.html("1 / "+this._archives.length),r=this._archives,i=s=0,n=r.length;n>s;i=++s)e=r[i],0===i?this._arr[i]=!0:this._arr[i]=!1;this._$carousel.on("slide.bs.carousel",this._startSlide),this._$carousel.on("slid.bs.carousel",this._completeSlide)}return t.prototype._startSlide=function(t){var e,i,s,n,r,o,a;for(e=$(t.relatedTarget),this._$data.velocity({opacity:[0,1]},{duration:200,easing:"linear"}),n=Number(e.attr("index"))+1,s=!0,a=this._arr,r=0,o=a.length;o>r;r++)i=a[r],i===!1&&(s=!1);return s&&$("#js-checkbox").is(":checked")&&(location.href="./slideshow.html?reload=1"),this._arr[n-1]=!0},t.prototype._completeSlide=function(t){var e,i,s;return e=$(t.relatedTarget),i=y.getArchiveById(e.attr("id")),this._$name.html(decodeURIComponent(i.name)),this._$msg.html(decodeURIComponent(i.message)),s=Number(e.attr("index"))+1,this._$counter.html(s+" / "+this._archives.length),this._$data.stop().velocity({opacity:[1,0]},{duration:500,easing:"linear"})},t.prototype._setItem=function(){var t,e,i,s,n,r,o,a;for(o=this._archives,a=[],i=n=0,r=o.length;r>n;i=++n)e=o[i],t=this._$item.clone(),s=new u.Item({$target:t,id:e.id,index:i}),this._$items.append(t),0===i&&(t.addClass("active"),e=y.getArchiveById(e.id),this._$name.html(decodeURIComponent(e.name)),this._$msg.html(decodeURIComponent(e.message))),a.push(s.open());return a},t}(),u.Item=function(){function t(t){this._$target=t.$target,this._id=t.id,this._index=t.index,this._$img=this._$target.find(".js-archivesItemImg"),this._data=null,this._$target.attr("id",this._id),this._$target.attr("index",this._index)}return t.prototype.open=function(){return this._data=y.getArchiveById(this._id),this._$target.velocity({opacity:[1,0]},{duration:500,easing:"linear",complete:function(t){return function(){return t._$img.attr("src","./data/"+t._data.image),t._$img.css({opacity:0}),t._$img.on("load",function(){return t._$img.velocity({opacity:[1,0]},{duration:500,easing:"linear"})})}}(this)})},t}(),a=function(){function t(t){this._$target=t.$target,this._getArchives=new g.GetArchives({$target:$("#js-modalGetArchives")})}return t.prototype.open=function(t){return t.id===o?this._getArchives.open({success:t.data.success}):void 0},t}(),g.GetArchives=function(){function t(t){this._onClosed=bind(this._onClosed,this),this._onOpened=bind(this._onOpened,this),this._$target=t.$target,this._$connect=$("#js-modalGetArchivesConnect"),this._$failure=$("#js-modalGetArchivesFailure"),this._$msg=$("#js-modalGetArchivesMsg"),this._success=null,this._data=null,this._$target.on("shown.bs.modal",this._onOpened),this._$target.on("hidden.bs.modal",this._onClosed)}return t.prototype.open=function(t){return this._success=t.success,this._toggleView({id:"connect"}),this._$target.modal({backdrop:"static",keyboard:!1})},t.prototype._onOpened=function(){return $.ajax({url:"api/getArchives.php",type:"POST",dataType:"json",cache:!1,timeout:1e4}).done(function(t){return function(e){return 0===e.code?(t._data=e.data,t._$target.modal("hide")):(t._$msg.html(e.msg),t._toggleView({id:"failure"}))}}(this)).fail(function(t){return function(){return t._$msg.html("データの取得に失敗しました"),t._toggleView({id:"failure"})}}(this))},t.prototype._onClosed=function(){return this._success?this._success({data:this._data}):void 0},t.prototype._toggleView=function(t){return"connect"===t.id?(this._$connect.css({display:"block"}),this._$failure.css({display:"none"})):"failure"===t.id?(this._$connect.css({display:"none"}),this._$failure.velocity({opacity:[1,0],translateY:[0,-50]},{duration:500,easing:"easeOutSine",display:"block"})):void 0},t}(),t.on(r,function(t,e){return d.open({id:e.id,data:e.data||null})}),p=function(t){return function(){return $("#js-container").css({height:s.height()-50})}}(this),s.on("resize",p),p(),y=new h,d=new a({$target:$("#js-modal")}),c=null,v=String(location.href).split("?")[1])for(m=v.split("&"),l=0,_=m.length;_>l;l++)f=m[l],"reload"===f.split("=")[0]&&"1"===f.split("=")[1]&&$("#js-checkbox").prop("checked",!0);return t.trigger(r,[{id:o,data:{success:function(e){return function(e){var i,s;return y.setArchives(e.data),s=location.hash,s&&(s=String(s).replace("#",""),i=y.getArchiveById(s),i&&t.trigger(r,[{id:ID_MODAL_DETAIL,data:{id:i.id}}],!1)),c=new n({$target:$("#js-archives")})}}(this)}}],!1)});